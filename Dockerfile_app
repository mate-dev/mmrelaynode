FROM python:3.11-slim-bookworm

RUN groupadd -g 1000 mesh && useradd -ml -u 1000 -g 1000 -s /bin/bash mesh

RUN pip install --upgrade pip -qq

USER mesh

VOLUME /home/mesh
COPY ./meshtastic-matrix-relay /home/mesh/app

RUN pip install -qq -r /home/mesh/app/requirements.txt

USER root
RUN chown -R mesh:mesh /mnt
#RUN bash -c "for f in /home/mesh/{*,.*}; do cp -r "$f" /mnt/; done"
COPY ./config.yaml /mnt/app/config.yaml
RUN chown -R mesh:mesh /mnt
USER mesh

WORKDIR /home/mesh
